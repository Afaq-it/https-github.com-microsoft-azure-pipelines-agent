#!/bin/bash

sudo -n apt-get update
sudo -n apt-get install -y ca-certificates curl apt-transport-https lsb-release gnupg
sudo -n mkdir -p /etc/apt/keyrings
curl -sLS https://packages.microsoft.com/keys/microsoft.asc |
    gpg --dearmor |
    sudo -n tee /etc/apt/keyrings/microsoft.gpg > /dev/null
sudo -n chmod go+r /etc/apt/keyrings/microsoft.gpg
AZ_DIST=$(lsb_release -cs)
echo "deb [arch=`dpkg --print-architecture` signed-by=/etc/apt/keyrings/microsoft.gpg] https://packages.microsoft.com/repos/azure-cli/ $AZ_DIST main" |
    sudo -n tee /etc/apt/sources.list.d/azure-cli.list
AZ_VER=2.52.0
sudo -n apt-get update
sudo -n apt-get install -y azure-cli=$AZ_VER-1~$AZ_DIST --allow-downgrades
